<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Automation - Live Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .btn-start {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        
        .btn-start:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .test-execution {
            min-height: 400px;
        }
        
        .step-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .step-action {
            font-weight: 600;
            color: #333;
        }
        
        .selector-display {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            color: #e83e8c;
            word-break: break-all;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-running { background: #17a2b8; color: white; }
        .status-success { background: #28a745; color: white; }
        .status-failed { background: #dc3545; color: white; }
        .status-healing { background: #ffc107; color: #333; }
        
        .healing-animation {
            border-left-color: #ffc107 !important;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .healed-item {
            border-left-color: #28a745 !important;
        }
        
        .healing-details {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .healing-success {
            background: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .scenario-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #0066cc;
        }
        
        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
        }
        
        .log-info { color: #0066cc; }
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-error { color: #dc3545; }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            z-index: 1000;
        }
        
        .connected {
            background: #28a745;
            color: white;
        }
        
        .disconnected {
            background: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="connection-status disconnected" id="connectionStatus">
        ‚ö´ Connecting...
    </div>
    
    <div class="container">
        <header>
            <h1>ü§ñ AI-Powered Test Automation</h1>
            <p class="subtitle">Live Automated Demo - Watch AI in Action!</p>
        </header>
        
        <div class="controls">
            <button class="btn-start" id="startBtn" onclick="startDemo()">
                ‚ñ∂Ô∏è Start Automated Demo
            </button>
            <p style="margin-top: 10px; color: #666;">
                Watch as tests run automatically with self-healing and selector reuse
            </p>
        </div>
        
        <div class="grid">
            <!-- Test Execution Panel -->
            <div class="card test-execution">
                <h2>üé¨ Live Test Execution</h2>
                
                <div id="scenarioInfo" style="display: none;" class="scenario-info">
                    <strong>Scenario:</strong> <span id="scenarioName">-</span><br>
                    <strong>Progress:</strong> <span id="stepProgress">0/0</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div id="executionSteps"></div>
                
                <div id="completionMessage" style="display: none; text-align: center; padding: 40px;">
                    <h3 style="color: #28a745;">‚úÖ Test Completed Successfully!</h3>
                    <p style="color: #666; margin-top: 10px;">All steps executed with automatic healing</p>
                </div>
            </div>
            
            <!-- Statistics Panel -->
            <div class="card">
                <h2>üìä Live Statistics</h2>
                
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalTests">0</div>
                        <div class="stat-label">Tests Run</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="healingRate">0%</div>
                        <div class="stat-label">Healing Success</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgTime">0ms</div>
                        <div class="stat-label">Avg Healing Time</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="selectorsLearned">0</div>
                        <div class="stat-label">Selectors Learned</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px; color: #667eea;">Activity Log</h3>
                <div class="log-container" id="activityLog"></div>
            </div>
        </div>
    </div>
    
    <script>
        let ws = null;
        let currentStep = 0;
        let totalSteps = 0;
        
        // Connect to WebSocket
        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8888/ws/demo');
            
            ws.onopen = () => {
                updateConnectionStatus(true);
                addLog('Connected to live demo server', 'success');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleMessage(data);
            };
            
            ws.onclose = () => {
                updateConnectionStatus(false);
                addLog('Disconnected from server', 'error');
                setTimeout(connectWebSocket, 3000);
            };
            
            ws.onerror = (error) => {
                addLog('WebSocket error', 'error');
            };
        }
        
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.className = 'connection-status connected';
                status.textContent = 'üü¢ Connected';
            } else {
                status.className = 'connection-status disconnected';
                status.textContent = 'üî¥ Disconnected';
            }
        }
        
        function handleMessage(data) {
            switch(data.type) {
                case 'scenario_start':
                    startScenario(data);
                    break;
                case 'step_start':
                    addStep(data);
                    break;
                case 'selector_failed':
                    showSelectorFailure(data);
                    break;
                case 'healing_start':
                    showHealingStart(data);
                    break;
                case 'healing_complete':
                    showHealingComplete(data);
                    break;
                case 'step_retry':
                    showStepRetry(data);
                    break;
                case 'step_success':
                    showStepSuccess(data);
                    break;
                case 'scenario_complete':
                    completeScenario(data);
                    break;
            }
        }
        
        function startScenario(data) {
            document.getElementById('scenarioInfo').style.display = 'block';
            document.getElementById('scenarioName').textContent = data.scenario;
            document.getElementById('executionSteps').innerHTML = '';
            document.getElementById('completionMessage').style.display = 'none';
            currentStep = 0;
            totalSteps = data.total_steps;
            updateProgress();
            addLog(`Starting scenario: ${data.scenario}`, 'info');
        }
        
        function addStep(data) {
            currentStep = data.step_number;
            updateProgress();
            
            const stepHtml = `
                <div class="step-item" id="step${data.step_number}">
                    <div class="step-header">
                        <div>
                            <span class="step-number">Step ${data.step_number}</span>
                            <span class="step-action">${data.action.toUpperCase()}: ${data.element}</span>
                        </div>
                        <span class="status-badge status-running" id="status${data.step_number}">Running...</span>
                    </div>
                    <div class="selector-display">${data.selector}</div>
                    <div id="details${data.step_number}"></div>
                </div>
            `;
            
            document.getElementById('executionSteps').insertAdjacentHTML('beforeend', stepHtml);
            addLog(`Step ${data.step_number}: ${data.action} ${data.element}`, 'info');
        }
        
        function showSelectorFailure(data) {
            const step = document.getElementById(`step${data.step_number}`);
            step.classList.add('healing-animation');
            
            const status = document.getElementById(`status${data.step_number}`);
            status.className = 'status-badge status-failed';
            status.textContent = '‚ùå Failed';
            
            addLog(`Selector failed: ${data.selector}`, 'error');
        }
        
        function showHealingStart(data) {
            const status = document.getElementById(`status${data.step_number}`);
            status.className = 'status-badge status-healing';
            status.textContent = 'üîß Healing...';
            
            addLog(`Starting self-healing for step ${data.step_number}`, 'warning');
        }
        
        function showHealingComplete(data) {
            const details = document.getElementById(`details${data.step_number}`);
            details.innerHTML = `
                <div class="healing-success">
                    <strong>‚úÖ Healed Successfully!</strong><br>
                    <strong>Old:</strong> <code>${data.old_selector}</code><br>
                    <strong>New:</strong> <code>${data.new_selector}</code><br>
                    <strong>Confidence:</strong> ${(data.confidence * 100).toFixed(0)}% | 
                    <strong>Time:</strong> ${data.healing_time_ms}ms | 
                    <strong>Method:</strong> ${data.method}
                </div>
            `;
            
            addLog(`Healed in ${data.healing_time_ms}ms with ${(data.confidence * 100).toFixed(0)}% confidence`, 'success');
        }
        
        function showStepRetry(data) {
            const status = document.getElementById(`status${data.step_number}`);
            status.className = 'status-badge status-success';
            status.textContent = '‚úÖ Success (Healed)';
            
            const step = document.getElementById(`step${data.step_number}`);
            step.classList.remove('healing-animation');
            step.classList.add('healed-item');
            
            addLog(`Step ${data.step_number} succeeded after healing`, 'success');
        }
        
        function showStepSuccess(data) {
            const status = document.getElementById(`status${data.step_number}`);
            status.className = 'status-badge status-success';
            status.textContent = `‚úÖ Success (${data.execution_time_ms}ms)`;
            
            addLog(`Step ${data.step_number} succeeded in ${data.execution_time_ms}ms`, 'success');
        }
        
        function completeScenario(data) {
            document.getElementById('completionMessage').style.display = 'block';
            document.getElementById('startBtn').disabled = false;
            
            addLog(`Scenario completed: ${data.statistics.successful}/${data.statistics.total_actions} steps successful`, 'success');
            
            // Update statistics
            loadStatistics();
        }
        
        function updateProgress() {
            document.getElementById('stepProgress').textContent = `${currentStep}/${totalSteps}`;
            const percent = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = percent + '%';
        }
        
        function addLog(message, type) {
            const log = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = `<div class="log-entry log-${type}">[${timestamp}] ${message}</div>`;
            log.insertAdjacentHTML('afterbegin', entry);
            
            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }
        
        async function startDemo() {
            document.getElementById('startBtn').disabled = true;
            
            try {
                const response = await fetch('/api/start-auto-demo', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    addLog('Starting automated demo...', 'info');
                }
            } catch (error) {
                addLog('Error starting demo: ' + error.message, 'error');
                document.getElementById('startBtn').disabled = false;
            }
        }
        
        async function loadStatistics() {
            try {
                const response = await fetch('/api/demo-statistics');
                const data = await response.json();
                
                document.getElementById('totalTests').textContent = data.total_tests_run;
                document.getElementById('healingRate').textContent = data.healing_success_rate + '%';
                document.getElementById('avgTime').textContent = data.avg_healing_time_ms + 'ms';
                document.getElementById('selectorsLearned').textContent = data.selectors_learned;
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            connectWebSocket();
            loadStatistics();
            setInterval(loadStatistics, 5000); // Update stats every 5 seconds
        });
    </script>
</body>
</html>
